var mysql = require('mysql');

class db{

    //构造函数
    constructor(data) {
        this.start(data);
    }

    start(data) {

        var connection = mysql.createConnection({
            host:'127.0.0.1',
            user :'root',
            password:'root',
            port : '3306',
            database:'huya'

        });

        connection.connect();

        // 拼接数组
        var userAddSql_Params = '';
        var sqlValue = ',';

        for (var i=0;i<data.length;i++){

            if (i ==(data.length - 1)){
                sqlValue = '';
            }

            userAddSql_Params += "('"+data[i]['username']+"','"+data[i]['content']+"',"+data[i]['createtime']+")"+sqlValue;
        }

        var userAddSql = 'INSERT INTO `hy_danmu` (`username`,`content`,`createtime`) VALUES '+userAddSql_Params;

        connection.query(userAddSql,false,function (err,result) {

            if (err){
                console.log('INSERT ERROR - ',err.message);
                return;
            }

            console.log('insert ok');
        });

        connection.end();

    }

}
module.exports = db;